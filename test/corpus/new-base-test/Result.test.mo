=========
Result.test.mo
=========

import Result "../src/Result";
import Int "../src/Int";
import { suite; test } "mo:test";

func makeNatural(x : Int) : Result.Result<Nat, Text> = if (x >= 0) {
  #ok(Int.abs(x))
} else { #err(Int.toText(x) # " is not a natural number.") };

func largerThan10(x : Nat) : Result.Result<Nat, Text> = if (x > 10) { #ok(x) } else {
  #err(Int.toText(x) # " is not larger than 10.")
};

suite(
  "chain",
  func() {
    test(
      "ok -> ok",
      func() {
        assert Result.chain<Nat, Nat, Text>(makeNatural(11), largerThan10) == #ok(11)
      }
    );

    test(
      "ok -> err",
      func() {
        assert Result.chain<Nat, Nat, Text>(makeNatural(5), largerThan10) == #err("5 is not larger than 10.")
      }
    );

    test(
      "err",
      func() {
        assert Result.chain<Nat, Nat, Text>(makeNatural(-5), largerThan10) == #err("-5 is not a natural number.")
      }
    )
  }
);

suite(
  "flatten",
  func() {
    test(
      "ok -> ok",
      func() {
        assert Result.flatten<Nat, Text>(#ok(#ok(10))) == #ok(10)
      }
    );

    test(
      "err",
      func() {
        assert Result.flatten<Nat, Text>(#err("wrong")) == #err("wrong")
      }
    );

    test(
      "ok -> err",
      func() {
        assert Result.flatten<Nat, Text>(#ok(#err("wrong"))) == #err("wrong")
      }
    )
  }
);

suite(
  "forOk",
  func() {
    var counter : Nat = 0;

    test(
      "ok",
      func() {
        Result.forOk(makeNatural(5), func(x : Nat) { counter += x });
        assert counter == 5
      }
    );

    test(
      "err",
      func() {
        Result.forOk(makeNatural(-10), func(x : Nat) { counter += x });
        assert counter == 5
      }
    )
  }
);

suite(
  "forErr",
  func() {
    var counter : Nat = 0;

    test(
      "ok",
      func() {
        Result.forErr(#err 5, func(x : Nat) { counter += x });
        assert counter == 5
      }
    );

    test(
      "err",
      func() {
        Result.forErr(#ok 5, func(x : Nat) { counter += x });
        assert counter == 5
      }
    )
  }
)

---

(source_file
  (import
    (var_pat
      (identifier))
    (text_literal))
  (import
    (var_pat
      (identifier))
    (text_literal))
  (import
    (obj_pat
      (pat_field
        (identifier))
      (pat_field
        (identifier)))
    (text_literal))
  (func_dec
    (identifier)
    (tup_pat
      (annot_pat
        (var_pat
          (identifier))
        (typ_annot
          (path_typ
            (typ_path
              (type_identifier))))))
    (typ_annot
      (path_typ
        (typ_path
          (identifier)
          (type_identifier))
        (path_typ
          (typ_path
            (type_identifier)))
        (path_typ
          (typ_path
            (type_identifier)))))
    (func_body
      (if_exp
        (par_exp
          (bin_exp_object
            (var_exp
              (identifier))
            (rel_op)
            (lit_exp
              (int_literal))))
        (block_exp
          (exp_dec
            (hash_exp
              (identifier)
              (par_exp
                (call_exp_object
                  (dot_exp_object
                    (var_exp
                      (identifier))
                    (identifier))
                  (par_exp
                    (var_exp
                      (identifier))))))))
        (block_exp
          (exp_dec
            (hash_exp
              (identifier)
              (par_exp
                (bin_exp_object
                  (call_exp_object
                    (dot_exp_object
                      (var_exp
                        (identifier))
                      (identifier))
                    (par_exp
                      (var_exp
                        (identifier))))
                  (bin_op)
                  (lit_exp
                    (text_literal))))))))))
  (func_dec
    (identifier)
    (tup_pat
      (annot_pat
        (var_pat
          (identifier))
        (typ_annot
          (path_typ
            (typ_path
              (type_identifier))))))
    (typ_annot
      (path_typ
        (typ_path
          (identifier)
          (type_identifier))
        (path_typ
          (typ_path
            (type_identifier)))
        (path_typ
          (typ_path
            (type_identifier)))))
    (func_body
      (if_exp
        (par_exp
          (bin_exp_object
            (var_exp
              (identifier))
            (rel_op)
            (lit_exp
              (int_literal))))
        (block_exp
          (exp_dec
            (hash_exp
              (identifier)
              (par_exp
                (var_exp
                  (identifier))))))
        (block_exp
          (exp_dec
            (hash_exp
              (identifier)
              (par_exp
                (bin_exp_object
                  (call_exp_object
                    (dot_exp_object
                      (var_exp
                        (identifier))
                      (identifier))
                    (par_exp
                      (var_exp
                        (identifier))))
                  (bin_op)
                  (lit_exp
                    (text_literal))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (call_exp_block
                                  (dot_exp_block
                                    (var_exp
                                      (identifier))
                                    (identifier))
                                  (inst
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))
                                  (par_exp
                                    (call_exp_object
                                      (var_exp
                                        (identifier))
                                      (par_exp
                                        (lit_exp
                                          (int_literal))))
                                    (var_exp
                                      (identifier))))
                                (rel_op)
                                (hash_exp
                                  (identifier)
                                  (par_exp
                                    (lit_exp
                                      (int_literal)))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (call_exp_block
                                  (dot_exp_block
                                    (var_exp
                                      (identifier))
                                    (identifier))
                                  (inst
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))
                                  (par_exp
                                    (call_exp_object
                                      (var_exp
                                        (identifier))
                                      (par_exp
                                        (lit_exp
                                          (int_literal))))
                                    (var_exp
                                      (identifier))))
                                (rel_op)
                                (hash_exp
                                  (identifier)
                                  (par_exp
                                    (lit_exp
                                      (text_literal)))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (call_exp_block
                                  (dot_exp_block
                                    (var_exp
                                      (identifier))
                                    (identifier))
                                  (inst
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))
                                  (par_exp
                                    (call_exp_object
                                      (var_exp
                                        (identifier))
                                      (par_exp
                                        (lit_exp
                                          (int_literal))))
                                    (var_exp
                                      (identifier))))
                                (rel_op)
                                (hash_exp
                                  (identifier)
                                  (par_exp
                                    (lit_exp
                                      (text_literal)))))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (call_exp_block
                                  (dot_exp_block
                                    (var_exp
                                      (identifier))
                                    (identifier))
                                  (inst
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))
                                  (par_exp
                                    (hash_exp
                                      (identifier)
                                      (par_exp
                                        (hash_exp
                                          (identifier)
                                          (par_exp
                                            (lit_exp
                                              (int_literal))))))))
                                (rel_op)
                                (hash_exp
                                  (identifier)
                                  (par_exp
                                    (lit_exp
                                      (int_literal)))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (call_exp_block
                                  (dot_exp_block
                                    (var_exp
                                      (identifier))
                                    (identifier))
                                  (inst
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))
                                  (par_exp
                                    (hash_exp
                                      (identifier)
                                      (par_exp
                                        (lit_exp
                                          (text_literal))))))
                                (rel_op)
                                (hash_exp
                                  (identifier)
                                  (par_exp
                                    (lit_exp
                                      (text_literal)))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (call_exp_block
                                  (dot_exp_block
                                    (var_exp
                                      (identifier))
                                    (identifier))
                                  (inst
                                    (path_typ
                                      (typ_path
                                        (type_identifier)))
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))
                                  (par_exp
                                    (hash_exp
                                      (identifier)
                                      (par_exp
                                        (hash_exp
                                          (identifier)
                                          (par_exp
                                            (lit_exp
                                              (text_literal))))))))
                                (rel_op)
                                (hash_exp
                                  (identifier)
                                  (par_exp
                                    (lit_exp
                                      (text_literal)))))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (var_dec
                (var_pat
                  (identifier))
                (typ_annot
                  (path_typ
                    (typ_path
                      (type_identifier))))
                (lit_exp
                  (int_literal)))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (call_exp_object
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))
                              (par_exp
                                (call_exp_object
                                  (var_exp
                                    (identifier))
                                  (par_exp
                                    (lit_exp
                                      (int_literal))))
                                (func_exp
                                  (tup_pat
                                    (annot_pat
                                      (var_pat
                                        (identifier))
                                      (typ_annot
                                        (path_typ
                                          (typ_path
                                            (type_identifier))))))
                                  (func_body
                                    (block_exp
                                      (exp_dec
                                        (binassign_exp_object
                                          (var_exp
                                            (identifier))
                                          (binassign_op)
                                          (var_exp
                                            (identifier))))))))))
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (var_exp
                                  (identifier))
                                (rel_op)
                                (lit_exp
                                  (int_literal)))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (call_exp_object
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))
                              (par_exp
                                (call_exp_object
                                  (var_exp
                                    (identifier))
                                  (par_exp
                                    (lit_exp
                                      (int_literal))))
                                (func_exp
                                  (tup_pat
                                    (annot_pat
                                      (var_pat
                                        (identifier))
                                      (typ_annot
                                        (path_typ
                                          (typ_path
                                            (type_identifier))))))
                                  (func_body
                                    (block_exp
                                      (exp_dec
                                        (binassign_exp_object
                                          (var_exp
                                            (identifier))
                                          (binassign_op)
                                          (var_exp
                                            (identifier))))))))))
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (var_exp
                                  (identifier))
                                (rel_op)
                                (lit_exp
                                  (int_literal)))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (var_dec
                (var_pat
                  (identifier))
                (typ_annot
                  (path_typ
                    (typ_path
                      (type_identifier))))
                (lit_exp
                  (int_literal)))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (call_exp_object
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))
                              (par_exp
                                (hash_exp
                                  (identifier)
                                  (lit_exp
                                    (int_literal)))
                                (func_exp
                                  (tup_pat
                                    (annot_pat
                                      (var_pat
                                        (identifier))
                                      (typ_annot
                                        (path_typ
                                          (typ_path
                                            (type_identifier))))))
                                  (func_body
                                    (block_exp
                                      (exp_dec
                                        (binassign_exp_object
                                          (var_exp
                                            (identifier))
                                          (binassign_op)
                                          (var_exp
                                            (identifier))))))))))
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (var_exp
                                  (identifier))
                                (rel_op)
                                (lit_exp
                                  (int_literal)))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (call_exp_object
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))
                              (par_exp
                                (hash_exp
                                  (identifier)
                                  (lit_exp
                                    (int_literal)))
                                (func_exp
                                  (tup_pat
                                    (annot_pat
                                      (var_pat
                                        (identifier))
                                      (typ_annot
                                        (path_typ
                                          (typ_path
                                            (type_identifier))))))
                                  (func_body
                                    (block_exp
                                      (exp_dec
                                        (binassign_exp_object
                                          (var_exp
                                            (identifier))
                                          (binassign_op)
                                          (var_exp
                                            (identifier))))))))))
                          (exp_dec
                            (assert_exp
                              (bin_exp_block
                                (var_exp
                                  (identifier))
                                (rel_op)
                                (lit_exp
                                  (int_literal))))))))))))))))))
