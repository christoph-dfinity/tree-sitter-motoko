=========
Option.test.mo
=========

import Option "../src/Option";
import Int "../src/Int";
import { suite; test; expect } "mo:test";
import Nat "../src/Nat";

suite(
  "apply",
  func() {
    test(
      "null function, null value",
      func() {
        assert (Option.apply<Int, Bool>(null, null) == null)
      }
    );

    test(
      "null function, non-null value",
      func() {
        assert (Option.apply<Int, Bool>(?0, null) == null)
      }
    );

    test(
      "non-null function, null value",
      func() {
        let isEven = func(x : Int) : Bool {
          x % 2 == 0
        };

        assert (Option.apply<Int, Bool>(null, ?isEven) == null)
      }
    );

    test(
      "non-null function, non-null value",
      func() {
        let isEven = func(x : Int) : Bool {
          x % 2 == 0
        };

        assert (Option.apply<Int, Bool>(?0, ?isEven) == ?true)
      }
    )
  }
);

suite(
  "bind",
  func() {
    test(
      "null value to null value",
      func() {
        let safeInt = func(x : Int) : ?Int {
          if (x > 9007199254740991) {
            null
          } else {
            ?x
          }
        };

        assert (Option.chain<Int, Int>(null, safeInt) == null)
      }
    );

    test(
      "non-null value to null value",
      func() {
        let safeInt = func(x : Int) : ?Int {
          if (x > 9007199254740991) {
            null
          } else {
            ?x
          }
        };

        assert (Option.chain<Int, Int>(?9007199254740992, safeInt) == null)
      }
    );

    test(
      "non-null value to non-null value",
      func() {
        let safeInt = func(x : Int) : ?Int {
          if (x > 9007199254740991) {
            null
          } else {
            ?x
          }
        };

        assert (Option.chain<Int, Int>(?0, safeInt) == ?0)
      }
    )
  }
);

suite(
  "flatten",
  func() {
    test(
      "null value",
      func() {
        assert (Option.flatten<Int>(?null) == null)
      }
    );

    test(
      "non-null value",
      func() {
        assert (Option.flatten<Int>(??0) == ?0)
      }
    )
  }
);

suite(
  "map",
  func() {
    test(
      "null value",
      func() {
        let isEven = func(x : Int) : Bool {
          x % 2 == 0
        };

        assert (Option.map<Int, Bool>(null, isEven) == null)
      }
    );

    test(
      "non-null value",
      func() {
        let isEven = func(x : Int) : Bool {
          x % 2 == 0
        };

        assert (Option.map<Int, Bool>(?0, isEven) == ?true)
      }
    )
  }
);

test(
  "forEach",
  func() {
    var witness = 0;
    Option.forEach<Nat>(?(1), func(x : Nat) { witness += 1 });
    assert (witness == 1);
    Option.forEach<Nat>(null, func(x : Nat) { witness += 1 });
    assert (witness == 1)
  }
);

test(
  "some",
  func() {
    assert (Option.some<Int>(0) == ?0)
  }
);

test(
  "equal",
  func() {
    assert (Option.equal<Int>(null, null, Int.equal));
    assert (Option.equal<Int>(?0, ?0, Int.equal));
    assert (not Option.equal<Int>(?0, ?1, Int.equal));
    assert (not Option.equal<Int>(?0, null, Int.equal));
    assert (not Option.equal<Int>(null, ?0, Int.equal))
  }
);

test(
  "compare",
  func() {
    expect.bool(Option.compare<Nat>(null, null, Nat.compare) == #equal).isTrue();
    expect.bool(Option.compare<Nat>(null, ?0, Nat.compare) == #less).isTrue();
    expect.bool(Option.compare<Nat>(?0, null, Nat.compare) == #greater).isTrue();
    expect.bool(Option.compare<Nat>(?0, ?0, Nat.compare) == #equal).isTrue();
    expect.bool(Option.compare<Nat>(?0, ?1, Nat.compare) == #less).isTrue();
    expect.bool(Option.compare<Nat>(?1, ?0, Nat.compare) == #greater).isTrue()
  }
);

test(
  "toText",
  func() {
    expect.text(Option.toText<Nat>(null, Nat.toText)).equal("null");
    expect.text(Option.toText<Nat>(?0, Nat.toText)).equal("?0")
  }
)

---

(source_file
  (import
    (var_pat
      (identifier))
    (text_literal))
  (import
    (var_pat
      (identifier))
    (text_literal))
  (import
    (obj_pat
      (pat_field
        (identifier))
      (pat_field
        (identifier))
      (pat_field
        (identifier)))
    (text_literal))
  (import
    (var_pat
      (identifier))
    (text_literal))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (lit_exp
                                        (null_literal))
                                      (lit_exp
                                        (null_literal))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (lit_exp
                                          (int_literal)))
                                      (lit_exp
                                        (null_literal))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (path_typ
                                  (typ_path
                                    (type_identifier))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (bin_exp_object
                                      (bin_exp_object
                                        (var_exp
                                          (identifier))
                                        (bin_op)
                                        (lit_exp
                                          (int_literal)))
                                      (rel_op)
                                      (lit_exp
                                        (int_literal))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (lit_exp
                                        (null_literal))
                                      (quest_exp
                                        (var_exp
                                          (identifier)))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (path_typ
                                  (typ_path
                                    (type_identifier))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (bin_exp_object
                                      (bin_exp_object
                                        (var_exp
                                          (identifier))
                                        (bin_op)
                                        (lit_exp
                                          (int_literal)))
                                      (rel_op)
                                      (lit_exp
                                        (int_literal))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (lit_exp
                                          (int_literal)))
                                      (quest_exp
                                        (var_exp
                                          (identifier)))))
                                  (rel_op)
                                  (quest_exp
                                    (lit_exp
                                      (bool_literal)))))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (quest_typ
                                  (path_typ
                                    (typ_path
                                      (type_identifier)))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (if_exp
                                      (par_exp
                                        (bin_exp_object
                                          (var_exp
                                            (identifier))
                                          (rel_op)
                                          (lit_exp
                                            (int_literal))))
                                      (block_exp
                                        (exp_dec
                                          (lit_exp
                                            (null_literal))))
                                      (block_exp
                                        (exp_dec
                                          (quest_exp
                                            (var_exp
                                              (identifier)))))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (lit_exp
                                        (null_literal))
                                      (var_exp
                                        (identifier))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (quest_typ
                                  (path_typ
                                    (typ_path
                                      (type_identifier)))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (if_exp
                                      (par_exp
                                        (bin_exp_object
                                          (var_exp
                                            (identifier))
                                          (rel_op)
                                          (lit_exp
                                            (int_literal))))
                                      (block_exp
                                        (exp_dec
                                          (lit_exp
                                            (null_literal))))
                                      (block_exp
                                        (exp_dec
                                          (quest_exp
                                            (var_exp
                                              (identifier)))))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (lit_exp
                                          (int_literal)))
                                      (var_exp
                                        (identifier))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (quest_typ
                                  (path_typ
                                    (typ_path
                                      (type_identifier)))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (if_exp
                                      (par_exp
                                        (bin_exp_object
                                          (var_exp
                                            (identifier))
                                          (rel_op)
                                          (lit_exp
                                            (int_literal))))
                                      (block_exp
                                        (exp_dec
                                          (lit_exp
                                            (null_literal))))
                                      (block_exp
                                        (exp_dec
                                          (quest_exp
                                            (var_exp
                                              (identifier)))))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (lit_exp
                                          (int_literal)))
                                      (var_exp
                                        (identifier))))
                                  (rel_op)
                                  (quest_exp
                                    (lit_exp
                                      (int_literal)))))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (lit_exp
                                          (null_literal)))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (quest_exp
                                          (lit_exp
                                            (int_literal))))))
                                  (rel_op)
                                  (quest_exp
                                    (lit_exp
                                      (int_literal)))))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (path_typ
                                  (typ_path
                                    (type_identifier))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (bin_exp_object
                                      (bin_exp_object
                                        (var_exp
                                          (identifier))
                                        (bin_op)
                                        (lit_exp
                                          (int_literal)))
                                      (rel_op)
                                      (lit_exp
                                        (int_literal))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (lit_exp
                                        (null_literal))
                                      (var_exp
                                        (identifier))))
                                  (rel_op)
                                  (lit_exp
                                    (null_literal))))))))))))
              (exp_dec
                (call_exp_object
                  (var_exp
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))
                    (func_exp
                      (tup_pat)
                      (func_body
                        (block_exp
                          (let_dec
                            (var_pat
                              (identifier))
                            (func_exp
                              (tup_pat
                                (annot_pat
                                  (var_pat
                                    (identifier))
                                  (typ_annot
                                    (path_typ
                                      (typ_path
                                        (type_identifier))))))
                              (typ_annot
                                (path_typ
                                  (typ_path
                                    (type_identifier))))
                              (func_body
                                (block_exp
                                  (exp_dec
                                    (bin_exp_object
                                      (bin_exp_object
                                        (var_exp
                                          (identifier))
                                        (bin_op)
                                        (lit_exp
                                          (int_literal)))
                                      (rel_op)
                                      (lit_exp
                                        (int_literal))))))))
                          (exp_dec
                            (assert_exp
                              (par_exp
                                (bin_exp_object
                                  (call_exp_object
                                    (dot_exp_object
                                      (var_exp
                                        (identifier))
                                      (identifier))
                                    (inst
                                      (path_typ
                                        (typ_path
                                          (type_identifier)))
                                      (path_typ
                                        (typ_path
                                          (type_identifier))))
                                    (par_exp
                                      (quest_exp
                                        (lit_exp
                                          (int_literal)))
                                      (var_exp
                                        (identifier))))
                                  (rel_op)
                                  (quest_exp
                                    (lit_exp
                                      (bool_literal)))))))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (var_dec
                (var_pat
                  (identifier))
                (lit_exp
                  (int_literal)))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (var_exp
                      (identifier))
                    (identifier))
                  (inst
                    (path_typ
                      (typ_path
                        (type_identifier))))
                  (par_exp
                    (quest_exp
                      (par_exp
                        (lit_exp
                          (int_literal))))
                    (func_exp
                      (tup_pat
                        (annot_pat
                          (var_pat
                            (identifier))
                          (typ_annot
                            (path_typ
                              (typ_path
                                (type_identifier))))))
                      (func_body
                        (block_exp
                          (exp_dec
                            (binassign_exp_object
                              (var_exp
                                (identifier))
                              (binassign_op)
                              (lit_exp
                                (int_literal))))))))))
              (exp_dec
                (assert_exp
                  (par_exp
                    (bin_exp_object
                      (var_exp
                        (identifier))
                      (rel_op)
                      (lit_exp
                        (int_literal))))))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (var_exp
                      (identifier))
                    (identifier))
                  (inst
                    (path_typ
                      (typ_path
                        (type_identifier))))
                  (par_exp
                    (lit_exp
                      (null_literal))
                    (func_exp
                      (tup_pat
                        (annot_pat
                          (var_pat
                            (identifier))
                          (typ_annot
                            (path_typ
                              (typ_path
                                (type_identifier))))))
                      (func_body
                        (block_exp
                          (exp_dec
                            (binassign_exp_object
                              (var_exp
                                (identifier))
                              (binassign_op)
                              (lit_exp
                                (int_literal))))))))))
              (exp_dec
                (assert_exp
                  (par_exp
                    (bin_exp_object
                      (var_exp
                        (identifier))
                      (rel_op)
                      (lit_exp
                        (int_literal))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (assert_exp
                  (par_exp
                    (bin_exp_object
                      (call_exp_object
                        (dot_exp_object
                          (var_exp
                            (identifier))
                          (identifier))
                        (inst
                          (path_typ
                            (typ_path
                              (type_identifier))))
                        (par_exp
                          (lit_exp
                            (int_literal))))
                      (rel_op)
                      (quest_exp
                        (lit_exp
                          (int_literal)))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (assert_exp
                  (par_exp
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (inst
                        (path_typ
                          (typ_path
                            (type_identifier))))
                      (par_exp
                        (lit_exp
                          (null_literal))
                        (lit_exp
                          (null_literal))
                        (dot_exp_object
                          (var_exp
                            (identifier))
                          (identifier)))))))
              (exp_dec
                (assert_exp
                  (par_exp
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (inst
                        (path_typ
                          (typ_path
                            (type_identifier))))
                      (par_exp
                        (quest_exp
                          (lit_exp
                            (int_literal)))
                        (quest_exp
                          (lit_exp
                            (int_literal)))
                        (dot_exp_object
                          (var_exp
                            (identifier))
                          (identifier)))))))
              (exp_dec
                (assert_exp
                  (par_exp
                    (not_exp
                      (call_exp_object
                        (dot_exp_object
                          (var_exp
                            (identifier))
                          (identifier))
                        (inst
                          (path_typ
                            (typ_path
                              (type_identifier))))
                        (par_exp
                          (quest_exp
                            (lit_exp
                              (int_literal)))
                          (quest_exp
                            (lit_exp
                              (int_literal)))
                          (dot_exp_object
                            (var_exp
                              (identifier))
                            (identifier))))))))
              (exp_dec
                (assert_exp
                  (par_exp
                    (not_exp
                      (call_exp_object
                        (dot_exp_object
                          (var_exp
                            (identifier))
                          (identifier))
                        (inst
                          (path_typ
                            (typ_path
                              (type_identifier))))
                        (par_exp
                          (quest_exp
                            (lit_exp
                              (int_literal)))
                          (lit_exp
                            (null_literal))
                          (dot_exp_object
                            (var_exp
                              (identifier))
                            (identifier))))))))
              (exp_dec
                (assert_exp
                  (par_exp
                    (not_exp
                      (call_exp_object
                        (dot_exp_object
                          (var_exp
                            (identifier))
                          (identifier))
                        (inst
                          (path_typ
                            (typ_path
                              (type_identifier))))
                        (par_exp
                          (lit_exp
                            (null_literal))
                          (quest_exp
                            (lit_exp
                              (int_literal)))
                          (dot_exp_object
                            (var_exp
                              (identifier))
                            (identifier))))))))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (bin_exp_object
                          (call_exp_object
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))
                            (inst
                              (path_typ
                                (typ_path
                                  (type_identifier))))
                            (par_exp
                              (lit_exp
                                (null_literal))
                              (lit_exp
                                (null_literal))
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))))
                          (rel_op)
                          (hash_exp
                            (identifier)))))
                    (identifier))
                  (par_exp)))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (bin_exp_object
                          (call_exp_object
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))
                            (inst
                              (path_typ
                                (typ_path
                                  (type_identifier))))
                            (par_exp
                              (lit_exp
                                (null_literal))
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))))
                          (rel_op)
                          (hash_exp
                            (identifier)))))
                    (identifier))
                  (par_exp)))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (bin_exp_object
                          (call_exp_object
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))
                            (inst
                              (path_typ
                                (typ_path
                                  (type_identifier))))
                            (par_exp
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (lit_exp
                                (null_literal))
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))))
                          (rel_op)
                          (hash_exp
                            (identifier)))))
                    (identifier))
                  (par_exp)))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (bin_exp_object
                          (call_exp_object
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))
                            (inst
                              (path_typ
                                (typ_path
                                  (type_identifier))))
                            (par_exp
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))))
                          (rel_op)
                          (hash_exp
                            (identifier)))))
                    (identifier))
                  (par_exp)))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (bin_exp_object
                          (call_exp_object
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))
                            (inst
                              (path_typ
                                (typ_path
                                  (type_identifier))))
                            (par_exp
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))))
                          (rel_op)
                          (hash_exp
                            (identifier)))))
                    (identifier))
                  (par_exp)))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (bin_exp_object
                          (call_exp_object
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))
                            (inst
                              (path_typ
                                (typ_path
                                  (type_identifier))))
                            (par_exp
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (quest_exp
                                (lit_exp
                                  (int_literal)))
                              (dot_exp_object
                                (var_exp
                                  (identifier))
                                (identifier))))
                          (rel_op)
                          (hash_exp
                            (identifier)))))
                    (identifier))
                  (par_exp)))))))))
  (exp_dec
    (call_exp_object
      (var_exp
        (identifier))
      (par_exp
        (lit_exp
          (text_literal))
        (func_exp
          (tup_pat)
          (func_body
            (block_exp
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (call_exp_object
                          (dot_exp_object
                            (var_exp
                              (identifier))
                            (identifier))
                          (inst
                            (path_typ
                              (typ_path
                                (type_identifier))))
                          (par_exp
                            (lit_exp
                              (null_literal))
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))))))
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal)))))
              (exp_dec
                (call_exp_object
                  (dot_exp_object
                    (call_exp_object
                      (dot_exp_object
                        (var_exp
                          (identifier))
                        (identifier))
                      (par_exp
                        (call_exp_object
                          (dot_exp_object
                            (var_exp
                              (identifier))
                            (identifier))
                          (inst
                            (path_typ
                              (typ_path
                                (type_identifier))))
                          (par_exp
                            (quest_exp
                              (lit_exp
                                (int_literal)))
                            (dot_exp_object
                              (var_exp
                                (identifier))
                              (identifier))))))
                    (identifier))
                  (par_exp
                    (lit_exp
                      (text_literal))))))))))))
