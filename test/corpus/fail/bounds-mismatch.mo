=========
bounds-mismatch.mo
=========

do {
  func f(g : <A>() -> ()) {};
  f(func<A>() {});  // okay
};

do {
  func f(g : <A <: Nat>() -> ()) {};
  f(func<A <: Nat>() {});  // okay
};

do {
  func f(g : <A>() -> ()) {};
  f(func() {});  // error
};

do {
  func f(g : () -> ()) {};
  f(func<A>() {});  // error
};

do {
  func f(g : <A>() -> ()) {};
  f(func<A <: Nat>() {});  // error
};

do {
  func f(g : <A <: Nat>() -> ()) {};
  f(func<A>() {});  // error
};

do {
  func f(g : <A <: Int>() -> ()) {};
  f(func<A <: Nat>() {});  // error
};

do {
  func f(g : <A <: Nat>() -> ()) {};
  f(func<A <: Int>() {});  // error
};

do {
  let _ = [func<A>() {}, func<A>() {}];  // okay
};

do {
  let _ = [func<A <: Nat>() {}, func<A <: Nat>() {}];  // okay
};

do {
  let _ = [func() {}, func<A>() {}];  // warn
};

do {
  let _ = [func<A>() {}, func<A <: Nat>() {}];  // warn
};

do {
  let _ = [func<A <: Int>() {}, func<A <: Nat>() {}];  // warn
};

do {
  // okay
  let _ = [func(_ : <A <: Nat>() -> ()) {}, func(_ : <A <: Nat>() -> ()) {}];
};

do {
  // no warning
  let _ : [None -> ()] = [func(_ : <A <: Nat>() -> ()) {}, func(_ : <A <: Int>() -> ()) {}];
};


do {
type A = <X> X -> X;
type B = <Y <: Nat> Y -> Y;
func f(x : A) : B = x;
};

do {
type A = <X <: Int, Y <: {}> X -> Y;
type B = <X <: Int, Y <: {x : Nat}> X -> Y;
func f(x : A) : B = x;
};

do {
type A = <X <: Nat, Y> X -> Y;
type B = <Y <: Nat, X <: Y> Y -> X;
func f(x : A) : B = x;
};

do {
type A = <X, Y> X -> X;
type B = <X <: Y, Y> X -> X;
func f(x : A) : B = x;
};

do {
type A = <X, Y, Z <: X> X -> X;
type B = <X, Y <: X, Z <: Y> X -> X;
func f(x : A) : B = x;
};

do {
class C() { public let x = 0 };
type A = <X <: {x : Int}> X -> X;
type B = <X <: C> X -> X;
func f(x : A) : B = x;
};

do {
class C<X <: Int>() {public func f() : X { f() }};
type A = <X, Y <: {f : () -> X}> X -> X;
type B = <X <: Nat, Y <: C<X>> X -> X;
func f(x : A) : B = x;
};

do {
class C<X <: Int>() {public func f() : X { f() }};
type A = <X, Y <: {f : () -> Nat}> X -> X;
type B = <X <: Nat, Y <: C<X>> X -> X;
func f(x : A) : B = x;
};


do {
  let poly_funcs4 = [
    func<A <: Int, B <: Nat> (as : [A], b : B) : A = as[0],
    func<B <: Nat, A <: Int> (bs : [B], a : A) : B = bs[0]
  ];
};

---

(source_file
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)
                      (path_typ
                        (typ_path
                          (type_identifier)))))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)
                    (path_typ
                      (typ_path
                        (type_identifier)))))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)
                    (path_typ
                      (typ_path
                        (type_identifier)))))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)
                      (path_typ
                        (typ_path
                          (type_identifier)))))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)
                      (path_typ
                        (typ_path
                          (type_identifier)))))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)
                    (path_typ
                      (typ_path
                        (type_identifier)))))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (func_typ
                  (typ_params
                    (typ_bind
                      (type_identifier)
                      (path_typ
                        (typ_path
                          (type_identifier)))))
                  (tup_typ)
                  (tup_typ)))))
          (func_body
            (block_exp)))
        (exp_dec
          (call_exp_object
            (var_exp
              (identifier))
            (par_exp
              (func_exp
                (typ_params
                  (typ_bind
                    (type_identifier)
                    (path_typ
                      (typ_path
                        (type_identifier)))))
                (tup_pat)
                (func_body
                  (block_exp))))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (let_dec
          (wild_pat)
          (array_exp
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)))
              (tup_pat)
              (func_body
                (block_exp)))
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)))
              (tup_pat)
              (func_body
                (block_exp)))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (let_dec
          (wild_pat)
          (array_exp
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat)
              (func_body
                (block_exp)))
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat)
              (func_body
                (block_exp)))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (let_dec
          (wild_pat)
          (array_exp
            (func_exp
              (tup_pat)
              (func_body
                (block_exp)))
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)))
              (tup_pat)
              (func_body
                (block_exp)))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (let_dec
          (wild_pat)
          (array_exp
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)))
              (tup_pat)
              (func_body
                (block_exp)))
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat)
              (func_body
                (block_exp)))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (let_dec
          (wild_pat)
          (array_exp
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat)
              (func_body
                (block_exp)))
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat)
              (func_body
                (block_exp)))))
        (line_comment))))
  (exp_dec
    (do_exp
      (block_exp
        (line_comment)
        (let_dec
          (wild_pat)
          (array_exp
            (func_exp
              (tup_pat
                (annot_pat
                  (wild_pat)
                  (typ_annot
                    (func_typ
                      (typ_params
                        (typ_bind
                          (type_identifier)
                          (path_typ
                            (typ_path
                              (type_identifier)))))
                      (tup_typ)
                      (tup_typ)))))
              (func_body
                (block_exp)))
            (func_exp
              (tup_pat
                (annot_pat
                  (wild_pat)
                  (typ_annot
                    (func_typ
                      (typ_params
                        (typ_bind
                          (type_identifier)
                          (path_typ
                            (typ_path
                              (type_identifier)))))
                      (tup_typ)
                      (tup_typ)))))
              (func_body
                (block_exp))))))))
  (exp_dec
    (do_exp
      (block_exp
        (line_comment)
        (let_dec
          (annot_pat
            (wild_pat)
            (typ_annot
              (array_typ
                (func_typ
                  (path_typ
                    (typ_path
                      (type_identifier)))
                  (tup_typ)))))
          (array_exp
            (func_exp
              (tup_pat
                (annot_pat
                  (wild_pat)
                  (typ_annot
                    (func_typ
                      (typ_params
                        (typ_bind
                          (type_identifier)
                          (path_typ
                            (typ_path
                              (type_identifier)))))
                      (tup_typ)
                      (tup_typ)))))
              (func_body
                (block_exp)))
            (func_exp
              (tup_pat
                (annot_pat
                  (wild_pat)
                  (typ_annot
                    (func_typ
                      (typ_params
                        (typ_bind
                          (type_identifier)
                          (path_typ
                            (typ_path
                              (type_identifier)))))
                      (tup_typ)
                      (tup_typ)))))
              (func_body
                (block_exp))))))))
  (exp_dec
    (do_exp
      (block_exp
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier)))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)
                (obj_typ)))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)
                (obj_typ
                  (val_tf
                    (identifier)
                    (path_typ
                      (typ_path
                        (type_identifier)))))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier)))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier))
              (typ_bind
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier))
              (typ_bind
                (type_identifier))
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier)))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier))
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier)))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (class_dec
          (type_identifier)
          (tup_pat)
          (class_body
            (obj_body
              (dec_field
                (vis)
                (let_dec
                  (var_pat
                    (identifier))
                  (lit_exp
                    (int_literal)))))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (obj_typ
                  (val_tf
                    (identifier)
                    (path_typ
                      (typ_path
                        (type_identifier)))))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier)))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (class_dec
          (type_identifier)
          (typ_params
            (typ_bind
              (type_identifier)
              (path_typ
                (typ_path
                  (type_identifier)))))
          (tup_pat)
          (class_body
            (obj_body
              (dec_field
                (vis)
                (func_dec
                  (identifier)
                  (tup_pat)
                  (typ_annot
                    (path_typ
                      (typ_path
                        (type_identifier))))
                  (func_body
                    (block_exp
                      (exp_dec
                        (call_exp_object
                          (var_exp
                            (identifier))
                          (par_exp))))))))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier))
              (typ_bind
                (type_identifier)
                (obj_typ
                  (val_tf
                    (identifier)
                    (func_typ
                      (tup_typ)
                      (path_typ
                        (typ_path
                          (type_identifier))))))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))
                  (path_typ
                    (typ_path
                      (type_identifier))))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (class_dec
          (type_identifier)
          (typ_params
            (typ_bind
              (type_identifier)
              (path_typ
                (typ_path
                  (type_identifier)))))
          (tup_pat)
          (class_body
            (obj_body
              (dec_field
                (vis)
                (func_dec
                  (identifier)
                  (tup_pat)
                  (typ_annot
                    (path_typ
                      (typ_path
                        (type_identifier))))
                  (func_body
                    (block_exp
                      (exp_dec
                        (call_exp_object
                          (var_exp
                            (identifier))
                          (par_exp))))))))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier))
              (typ_bind
                (type_identifier)
                (obj_typ
                  (val_tf
                    (identifier)
                    (func_typ
                      (tup_typ)
                      (path_typ
                        (typ_path
                          (type_identifier))))))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (typ_dec
          (type_identifier)
          (func_typ
            (typ_params
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))))
              (typ_bind
                (type_identifier)
                (path_typ
                  (typ_path
                    (type_identifier))
                  (path_typ
                    (typ_path
                      (type_identifier))))))
            (path_typ
              (typ_path
                (type_identifier)))
            (path_typ
              (typ_path
                (type_identifier)))))
        (func_dec
          (identifier)
          (tup_pat
            (annot_pat
              (var_pat
                (identifier))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))))
          (typ_annot
            (path_typ
              (typ_path
                (type_identifier))))
          (func_body
            (var_exp
              (identifier)))))))
  (exp_dec
    (do_exp
      (block_exp
        (let_dec
          (var_pat
            (identifier))
          (array_exp
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier))))
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat
                (annot_pat
                  (var_pat
                    (identifier))
                  (typ_annot
                    (array_typ
                      (path_typ
                        (typ_path
                          (type_identifier))))))
                (annot_pat
                  (var_pat
                    (identifier))
                  (typ_annot
                    (path_typ
                      (typ_path
                        (type_identifier))))))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))
              (func_body
                (array_idx_exp_object
                  (var_exp
                    (identifier))
                  (lit_exp
                    (int_literal)))))
            (func_exp
              (typ_params
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier))))
                (typ_bind
                  (type_identifier)
                  (path_typ
                    (typ_path
                      (type_identifier)))))
              (tup_pat
                (annot_pat
                  (var_pat
                    (identifier))
                  (typ_annot
                    (array_typ
                      (path_typ
                        (typ_path
                          (type_identifier))))))
                (annot_pat
                  (var_pat
                    (identifier))
                  (typ_annot
                    (path_typ
                      (typ_path
                        (type_identifier))))))
              (typ_annot
                (path_typ
                  (typ_path
                    (type_identifier))))
              (func_body
                (array_idx_exp_object
                  (var_exp
                    (identifier))
                  (lit_exp
                    (int_literal)))))))))))
